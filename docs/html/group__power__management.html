<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STC15W408AS library: Power management</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">STC15W408AS library<span id="projectnumber">&#160;0.13.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a>  </div>
  <div class="headertitle"><div class="title">Power management</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gacae7914e25fb794eb0d55b0162f8f8f6" id="r_gacae7914e25fb794eb0d55b0162f8f8f6"><td class="memItemLeft" align="right" valign="top"><a id="gacae7914e25fb794eb0d55b0162f8f8f6" name="gacae7914e25fb794eb0d55b0162f8f8f6"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>WIRC_H_ADDRESS</b>&#160;&#160;&#160;0xf8</td></tr>
<tr class="memdesc:gacae7914e25fb794eb0d55b0162f8f8f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wakeup timer internal clock frequency value high byte address. <br /></td></tr>
<tr class="separator:gacae7914e25fb794eb0d55b0162f8f8f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga82e21440e9b642907b03b4f1d111ca7b" id="r_ga82e21440e9b642907b03b4f1d111ca7b"><td class="memItemLeft" align="right" valign="top"><a id="ga82e21440e9b642907b03b4f1d111ca7b" name="ga82e21440e9b642907b03b4f1d111ca7b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>WIRC_L_ADDRESS</b>&#160;&#160;&#160;0xf9</td></tr>
<tr class="memdesc:ga82e21440e9b642907b03b4f1d111ca7b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wakeup timer internal clock frequency value low byte address. <br /></td></tr>
<tr class="separator:ga82e21440e9b642907b03b4f1d111ca7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga89e1b35bd6cbaf15cc0d33631acac076" id="r_ga89e1b35bd6cbaf15cc0d33631acac076"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__power__management.html#ga89e1b35bd6cbaf15cc0d33631acac076">idle</a>()&#160;&#160;&#160;(bit_set(PCON, SBIT0))</td></tr>
<tr class="memdesc:ga89e1b35bd6cbaf15cc0d33631acac076"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set MCU idle mode.  <br /></td></tr>
<tr class="separator:ga89e1b35bd6cbaf15cc0d33631acac076"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1e0d38ad57d2078db65a84e857f5e5b6" id="r_ga1e0d38ad57d2078db65a84e857f5e5b6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__power__management.html#ga1e0d38ad57d2078db65a84e857f5e5b6">power_down</a>()</td></tr>
<tr class="memdesc:ga1e0d38ad57d2078db65a84e857f5e5b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set MCU power down mode.  <br /></td></tr>
<tr class="separator:ga1e0d38ad57d2078db65a84e857f5e5b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadd59513e05eeefc7f94d3b4d47993c9e" id="r_gadd59513e05eeefc7f94d3b4d47993c9e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__power__management.html#gadd59513e05eeefc7f94d3b4d47993c9e">wakeup_timer_init</a>(ticks)</td></tr>
<tr class="memdesc:gadd59513e05eeefc7f94d3b4d47993c9e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Init and run wakeup timer.  <br /></td></tr>
<tr class="separator:gadd59513e05eeefc7f94d3b4d47993c9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga91ea0552ad4f4846e01e2ae59adce627" id="r_ga91ea0552ad4f4846e01e2ae59adce627"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__power__management.html#ga91ea0552ad4f4846e01e2ae59adce627">wakeup_timer_internal_clk_freq</a>()&#160;&#160;&#160;(((uint16_t)*wirc_h_ptr &lt;&lt; 8) | *wirc_l_ptr)</td></tr>
<tr class="memdesc:ga91ea0552ad4f4846e01e2ae59adce627"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get wakeup timer internal clock frequency.  <br /></td></tr>
<tr class="separator:ga91ea0552ad4f4846e01e2ae59adce627"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga930b8a866ce00b34528a4c24436d7c0a" id="r_ga930b8a866ce00b34528a4c24436d7c0a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__power__management.html#ga930b8a866ce00b34528a4c24436d7c0a">power_low_voltage_flag_get</a>()&#160;&#160;&#160;(get_bit(PCON, 5))</td></tr>
<tr class="memdesc:ga930b8a866ce00b34528a4c24436d7c0a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the status of the low voltage detection flag.  <br /></td></tr>
<tr class="separator:ga930b8a866ce00b34528a4c24436d7c0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9863918f1eedbe577046485380a9a3d2" id="r_ga9863918f1eedbe577046485380a9a3d2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__power__management.html#ga9863918f1eedbe577046485380a9a3d2">power_low_voltage_flag_clear</a>()&#160;&#160;&#160;(bit_clr(PCON, CBIT5))</td></tr>
<tr class="memdesc:ga9863918f1eedbe577046485380a9a3d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clears the low voltage detection flag in the PCON register.  <br /></td></tr>
<tr class="separator:ga9863918f1eedbe577046485380a9a3d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Functions and data structures related for MCU power management </p><dl class="section author"><dt>Author</dt><dd>Michael Golovanov </dd></dl>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ga89e1b35bd6cbaf15cc0d33631acac076" name="ga89e1b35bd6cbaf15cc0d33631acac076"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga89e1b35bd6cbaf15cc0d33631acac076">&#9670;&#160;</a></span>idle</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define idle</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td>&#160;&#160;&#160;(bit_set(PCON, SBIT0))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set MCU idle mode. </p>
<p>Shuts off clock to CPU, but clock to Timers, Interrupts, Serial Ports, and Analog Peripherals are still active. The CPU status is preserved in its entirety: the RAM, Stack Pointer, Program Counter, Program Status Word, Accumulator, and all other registers maintain their data during Idle. The port pins hold the logical states they had at the time Idle was activated. <br  />
 </p>

</div>
</div>
<a id="ga1e0d38ad57d2078db65a84e857f5e5b6" name="ga1e0d38ad57d2078db65a84e857f5e5b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1e0d38ad57d2078db65a84e857f5e5b6">&#9670;&#160;</a></span>power_down</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define power_down</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> {                            \</div>
<div class="line">    bit_set(PCON, SBIT1);       \</div>
<div class="line">    __asm__(<span class="stringliteral">&quot;nop&quot;</span>);             \</div>
<div class="line">    __asm__(<span class="stringliteral">&quot;nop&quot;</span>);             \</div>
<div class="line">    __asm__(<span class="stringliteral">&quot;nop&quot;</span>);             \</div>
<div class="line">} <span class="keywordflow">while</span>(0)</div>
</div><!-- fragment -->
<p>Set MCU power down mode. </p>
<p>In the Stop/Power-Down mode, the on-chip oscillator and the Flash memory are stopped in order to minimize power consumption. Only the power-on circuitry will continue to draw power during Stop/Power-Down. The contents of on-chip RAM and SFRs are maintained. </p>

</div>
</div>
<a id="ga9863918f1eedbe577046485380a9a3d2" name="ga9863918f1eedbe577046485380a9a3d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9863918f1eedbe577046485380a9a3d2">&#9670;&#160;</a></span>power_low_voltage_flag_clear</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define power_low_voltage_flag_clear</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td>&#160;&#160;&#160;(bit_clr(PCON, CBIT5))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clears the low voltage detection flag in the PCON register. </p>
<p>This macro clears the low voltage detection flag by resetting bit 5 (CBIT5) of the PCON (Power Control) register. This flag is set when a low voltage condition is detected, and must be manually cleared by software. </p>

</div>
</div>
<a id="ga930b8a866ce00b34528a4c24436d7c0a" name="ga930b8a866ce00b34528a4c24436d7c0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga930b8a866ce00b34528a4c24436d7c0a">&#9670;&#160;</a></span>power_low_voltage_flag_get</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define power_low_voltage_flag_get</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td>&#160;&#160;&#160;(get_bit(PCON, 5))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieves the status of the low voltage detection flag. </p>
<p>This macro reads the state of bit 5 (SBIT5) in the PCON (Power Control) register to determine if the low voltage detection flag is set. It is typically used in microcontrollers to check whether a low voltage condition has been detected during operation.</p>
<dl class="section return"><dt>Returns</dt><dd>Returns the value of bit 5 in the PCON register:<ul>
<li>0 if the bit is not set (no low voltage condition),</li>
<li>1 if the bit is set (low voltage condition detected). </li>
</ul>
</dd></dl>

</div>
</div>
<a id="gadd59513e05eeefc7f94d3b4d47993c9e" name="gadd59513e05eeefc7f94d3b4d47993c9e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gadd59513e05eeefc7f94d3b4d47993c9e">&#9670;&#160;</a></span>wakeup_timer_init</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define wakeup_timer_init</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">ticks</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> {                                                    \</div>
<div class="line">    WKTCH = (ticks &gt;&gt; 8) | 0x80;                        \</div>
<div class="line">    WKTCL = ticks &amp; 0xff;                               \</div>
<div class="line">} <span class="keywordflow">while</span>(0)</div>
</div><!-- fragment -->
<p>Init and run wakeup timer. </p>
<p>Wakeup time is calculated as (10^6/wakeup_timer_internal_clock_frequency) * 16 * ticks</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__power__management.html#ga91ea0552ad4f4846e01e2ae59adce627" title="Get wakeup timer internal clock frequency.">wakeup_timer_internal_clk_freq()</a></dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ticks</td><td>uint16_t wakeup timer ticks count </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga91ea0552ad4f4846e01e2ae59adce627" name="ga91ea0552ad4f4846e01e2ae59adce627"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga91ea0552ad4f4846e01e2ae59adce627">&#9670;&#160;</a></span>wakeup_timer_internal_clk_freq</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define wakeup_timer_internal_clk_freq</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td>&#160;&#160;&#160;(((uint16_t)*wirc_h_ptr &lt;&lt; 8) | *wirc_l_ptr)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get wakeup timer internal clock frequency. </p>
<p>wakeup timer internal clock frequency after MCU powerup is placed in RAM __idata 0xf8-0xf9 adresses.</p>
<p>By default SDCC compiler generate firmware part that before main() call clear RAM and 0xf8-0xf9 contains 0x00 values.</p>
<p>To avoid memory clearing implement empty <br  />
 void _mcs51_genRAMCLEAR() {} routine. Otherwise routine call return result 0x00.</p>
<p>Default value is 0x8c0a = 35850Hz.</p>
<dl class="section return"><dt>Returns</dt><dd>uint16_t wakeup timer internal clock frequency from 0xf8-0xf9 RAM </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
